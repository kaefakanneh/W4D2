<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.jsdelivr.net/npm/ruby-3_2-wasm-wasi@2.1.0/dist/browser.script.iife.js"></script>
    <script src="./pieces/piece.rb"  type="text/ruby"></script>
    <script src="./pieces/slidable.rb"  type="text/ruby"></script>
    <script src="./pieces/stepable.rb"  type="text/ruby"></script>
    <script src="./pieces/bishop.rb"  type="text/ruby"></script>
    <script src="./pieces/king.rb"  type="text/ruby"></script>
    <script src="./pieces/knight.rb"  type="text/ruby"></script>
    <script src="./pieces/NullPiece.rb"  type="text/ruby"></script>
    <script src="./pieces/pawn.rb"  type="text/ruby"></script>
    <script src="./pieces/queen.rb"  type="text/ruby"></script>
    <script src="./pieces/rook.rb"  type="text/ruby"></script>
    <script src="./board.rb"  type="text/ruby"></script>
    <script type="text/ruby">
        require 'js'
        JS.global[:document].getElementsByTagName('h1')[0][:innerText] = "Loaded!"
        b = Board.new
        b_indices = (0..7).map{|i|(0..7).each_with_object(i).to_a}.transpose.flatten(1)
        table =  JS.global[:document].getElementsByTagName('table').call(:item, 0)
        rows = table[:children].call(:item, 0)[:children]

        get_cell = lambda do |i, j|
            rows.call(:item, i)[:children].call(:item, j)
        end

        active_cell = get_cell.(0, 0)

        setup_cell = proc do  |cell, i, j|
            cell[:innerText] = b[[i, j]].symbol
            cell[:onclick] = proc do
                b_indices.map { |c| get_cell.(*c)[:style][:boxShadow] = "" }
                active_cell[:classList].call(:remove, "border-2", "border-black")
                active_cell = cell
                cell[:classList].call(:add, "border-2", "border-black")
                b[[i, j]].moves.each { |move| get_cell.(*move)[:style][:boxShadow] = "inset 0 0 14px #16a34a" }
            end.to_js
        end
        iterate_cells = proc do |cell, idx_cell| 
            setup_cell.call(cell, JS.global[:idx_row].to_i, idx_cell.to_i) 
        end.to_js
        iterate_rows = proc do |row, idx_row| 
            JS.global[:idx_row] = idx_row
            JS.global[:Array].call(:from, row[:children]).call(:forEach, iterate_cells)
        end.to_js
        JS.global[:Array].call(:from, rows).call(:forEach, iterate_rows)

    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Document</title>
</head>

<body>
    <div class="h-[100vh] flex flex-col justify-center items-center">
        <h1 class="text-2xl">Loading...</h1>
        <p>i love ruby</p>
        <table class="border-2 border-black cursor-pointer">
            <tr>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="even:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
            <tr>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
                <td class="odd:bg-gray-300 hover:bg-gray-500 w-8 h-8 text-center">...</td>
            </tr>
        </table>
    </div>
</body>

</html>